
@{
    ViewBag.Title = "JsApiPay";
}

<div align="center">
    <br />
    <br />
    <br />
    <input id="btnSubmit" class="button" type="button" style="background:#f49800; color:#fff;" onclick="callpay()" value="立即购买" />
</div>
<br />

<script type="text/javascript">
    var _data = { appId: 'wx2421b1c4370ec43b', timeStamp: '1395712654', nonceStr: 'e61463f8efa94090b1f366cccfbbb444', package: 'prepay_id=u802345jgfjsdfgsdg888', signType: 'MD5', paySign: '70EA570631E4BB79628FBCA90534C63FF7FADD89' };

    //调用微信JS api 支付
    function jsApiCall() {
        WeixinJSBridge.invoke(
            'getBrandWCPayRequest',
            _data,
            function (res) {
                WeixinJSBridge.log(res.err_msg);
                alert(res.err_code + res.err_desc + res.err_msg);
            }
        );
    }

    function callpay() {
        if (typeof WeixinJSBridge == "undefined") {
            if (document.addEventListener)
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            else if (document.attachEvent) {
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }
        else
            jsApiCall();
    }

</script>
